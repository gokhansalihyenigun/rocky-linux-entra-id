---
title: Monitoring & Logging Data Flow
---
flowchart LR
    subgraph VM["ğŸ–¥ï¸ Rocky Linux VM"]
        subgraph Logs["ğŸ“ System Logs"]
            Syslog["ğŸ“„ /var/log/secure<br/>SSH, sudo, auth"]
            Messages["ğŸ“„ /var/log/messages<br/>System events"]
            Journal["ğŸ“„ journalctl<br/>Systemd logs"]
        end
        
        subgraph Metrics["ğŸ“Š System Metrics"]
            CPU["ğŸ”¥ CPU Usage<br/>% Processor Time"]
            Memory["ğŸ§  Memory<br/>Available MB"]
            Disk["ğŸ’¾ Disk<br/>Used Space %"]
            Network["ğŸŒ Network<br/>Traffic bytes/sec"]
        end
    end
    
    subgraph AMA["ğŸ”Œ Azure Monitor Agent"]
        Collector["ğŸ“¦ Data Collector<br/>Collects from:<br/>- Syslog<br/>- Performance counters<br/>- Custom logs"]
        Processor["âš™ï¸ Data Processor<br/>- Filters<br/>- Transforms<br/>- Batches"]
    end
    
    subgraph Azure["â˜ï¸ Azure Cloud"]
        subgraph DCR["ğŸ“‹ Data Collection Rule"]
            Rules["ğŸ“ Collection Rules<br/>- Syslog facilities<br/>- Performance counters<br/>- Sampling rate: 60s"]
        end
        
        subgraph LAW["ğŸ“ˆ Log Analytics Workspace"]
            subgraph Tables["ğŸ“Š Data Tables"]
                SyslogTable["Syslog Table<br/>- SSH logins<br/>- Sudo commands<br/>- Auth events"]
                PerfTable["Perf Table<br/>- CPU metrics<br/>- Memory metrics<br/>- Disk metrics"]
            end
            
            Retention["â±ï¸ 30-day Retention<br/>PerGB2018 pricing"]
        end
        
        subgraph Analysis["ğŸ” Analysis & Alerting"]
            KQL["ğŸ“ KQL Queries<br/>Kusto Query Language"]
            Dashboard["ğŸ“Š Dashboards<br/>Visual insights"]
            Alerts["ğŸš¨ Alerts<br/>Email/SMS/Webhook"]
        end
    end
    
    User["ğŸ‘¤ Administrator"]
    
    Logs --> Collector
    Metrics --> Collector
    Messages --> Collector
    Journal --> Collector
    
    Collector --> Processor
    Processor -->|"HTTPS/TLS"| Rules
    Rules -->|"Routes data"| Tables
    
    SyslogTable --> Retention
    PerfTable --> Retention
    
    Retention --> KQL
    KQL --> Dashboard
    KQL --> Alerts
    
    User -->|"View & Query"| Dashboard
    User -->|"Write queries"| KQL
    Alerts -->|"Notify"| User
    
    style VM fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style AMA fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style DCR fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style LAW fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style Analysis fill:#fff9c4,stroke:#f57f17,stroke-width:2px
